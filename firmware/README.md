# Geckokapula
Silicon Labs EFR32 transceivers give access to filtered IQ samples on receive,
so it's possible to make an all-mode handheld receiver on them.

Currently it has a crude spectrogram display, FM, AM and DSB demodulators
and FM transmitter.

There's a simple user interface:
Rotate encoder to change the value under the cursor.
Push the encoder while rotating it to move the cursor.

# Construction
BRD4151A radio board (with EFR32MG1P232F256GM48)
is connected to a display and a speaker.

The display is something like this: https://www.ebay.com/itm/232327157750

Speaker is driven from a PWM output through a series capacitor and a resistor.

| Board pin | EFR32 pin | Connection   |
|-----------|-----------|--------------|
|   GND     |           | Ground plane |
| VMCU\_IN  |           | +3.3 V       |
|   P1      |   PC6     | Display SDA  |
|   P3      |   PC7     | Display CS   |
|   P5      |   PC8     | Display SCK  |
|   P7      |   PC9     | Display AO   |
|   P12     |   PC10    | Display LED  |
|   P9      |   PA0     | Debug UART TX (currently not used) |
|   P11     |   PA1     | Debug UART RX (currently not used) |
|   P34     |   PF6     | PTT or CW key (switch to GND) (optional) |
|   P4      |   PD10    | PWM Audio out |
|   P6      |   PD11    | Encoder A (switch to GND) |
|   P8      |   PD12    | Encoder B (switch to GND) |
|   P31/F18 |   PD13    | Encoder push button (switch to GND) |
|   F14     |   PD15    | Audio in, biased around 0.625 V |
|   P24     |   PF0     | J-link SWCLK |
|   P26     |   PF1     | J-link SWDIO |

VCC and RESET pins on display are connected to +3.3 V.

If you push wires straight to the radio board headers, reading pinout from the
datasheet is prone to mistakes as you are looking at it mirrored.
Here's a mirrored pinout to help: http://oh2eat.dy.fi/brd4151a-pinout.png

# Files in the project
The project was originally made in Simplicity Studio.
Simplicity Studio, however, was found difficult to use for development
since a project opened on another machine was usually broken, its
configuration generators regularly broke something in the project,
and it was quite frustrating in general. Now the code can be compiled
with `make`, and Simplicity Studio is only needed to generate the
radio configuration.

The application code is under src/ and inc/.

*InitDevice.c*, *InitDevice.h*, *rail_config.c* and *rail_config.h*
have been generated by Simplicity Studio long ago. These were generated
based on the *\*.isc* and *\*.hwconf* files, which probably wouldn't
open properly on a newer version. I didn't bother even trying though.
Other generated files have been removed since they did nothing useful
and only cluttered the directory and were mustly a nuisance even when
using Studio to build the program.
*efr32_radio_configurator_log.txt* was also kept since it contains
useful information such as the sample rate of the I/Q stream.

The long term plan is to move the RAIL configuration to a separate
dummy Studio project which contains no application code.
Surprisingly, the old RAIL configuration tables still worked with
RAIL 2 by careful copy-paste of some critical parts from another
RAIL 2-based program, so generating new configuration wasn't
strictly necessary yet.

Font is from https://github.com/dhepper/font8x8/

# Compiling and flashing
See https://github.com/tejeez/efr32-template/ for instructions.

Programming with openocd sometimes doesn't work.
Try programming with Simplicity Commander in that case.

To read debug prints, use
https://gist.github.com/tejeez/ccdf3d03740bdffaf93b992b114aeb51
